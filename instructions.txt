kubectl create namespace vault

Install nginx:
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
helm install nginx-ingress ingress-nginx/ingress-nginx --namespace ingress-nginx --create-namespace

Install and Set Up vault:

helm repo add hashicorp https://helm.releases.hashicorp.com
helm pull hashicorp/vault --version 0.31.0
tar -xvf vault-0.31.0.tgz

helm install vault hashicorp/vault -n vault --create-namespace -f vault/values.yaml

helm upgrade vault hashicorp/vault -n vault --create-namespace -f vault/values.yaml


Shell into pod and run:

/ $ vault operator init

Then unseal 3 times using the tokens:

vault operator unseal
vault operator unseal
vault operator unseal

Verify status:

vault status


Access ui:
Host entry: 10.10.3.27 vault.example.com

http://vault.example.com:31334/ui/ 
Token: Root token (hvs.FiwdU9nJngJHjSrL33kaYq22)

Deploy postgress: 

# add repo for postgres-operator
helm repo add postgres-operator-charts https://opensource.zalando.com/postgres-operator/charts/postgres-operator

# install the postgres-operator
helm install postgres-operator postgres-operator-charts/postgres-operator

# add repo for postgres-operator-ui
helm repo add postgres-operator-ui-charts https://opensource.zalando.com/postgres-operator/charts/postgres-operator-ui

# install the postgres-operator-ui
helm install postgres-operator-ui postgres-operator-ui-charts/postgres-operator-ui -n postgress --create-namespace


kubectl port-forward svc/postgres-operator-ui 8081:80


kubectl create -f postgres/manifest.yaml -n postgress

make targetNamespace: "*" in operator-ui deployment and restart


In Vault UI:

create secret engine in vault- database

create database connection

create role

Create statement:  
CREATE ROLE "{{name}}" WITH LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}';
GRANT ALL PRIVILEGES ON DATABASE foo TO "{{name}}";

wip...


Links: https://github.com/zalando/postgres-operator/blob/master/docs/quickstart.md#helm-chart,
